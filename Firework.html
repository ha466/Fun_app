<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival of Lights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            overflow: hidden;
        }
        .font-serif {
            font-family: 'Playfair Display', serif;
        }
        .hidden-content {
            display: none;
        }
        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-out;
        }
        #star-sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            overflow: hidden;
            z-index: -1;
        }
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 5s infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1); }
        }
        .card {
            background-color: rgba(26, 32, 44, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .diya {
            width: 80px;
            height: 60px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 10;
        }
        .diya:hover {
            transform: scale(1.1);
        }
        .diya-base {
            width: 100%;
            height: 30px;
            background-color: #e53e3e;
            border-radius: 0 0 40px 40px;
            position: absolute;
            bottom: 0;
            border: 2px solid #c53030;
        }
        .diya-flame {
            width: 20px;
            height: 40px;
            background-color: #f6ad55;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 0 10px #f6ad55, 0 0 20px #f6ad55, 0 0 30px #f6e05e;
            animation: flicker 1.5s infinite alternate;
        }
        .diya-flame.lit {
            opacity: 1;
        }
        @keyframes flicker {
            0% { transform: translateX(-50%) scaleY(1) rotate(-1deg); }
            50% { transform: translateX(-50%) scaleY(1.05) rotate(1deg); }
            100% { transform: translateX(-50%) scaleY(1) rotate(-2deg); }
        }
        .sound-btn {
            transition: all 0.2s ease-in-out;
        }
        .sound-btn:hover {
            transform: scale(1.1);
        }
        /* Updated Firework styles for bigger size */
        .firework {
            position: absolute;
            width: 20px; /* Increased initial size */
            height: 20px; /* Increased initial size */
            border-radius: 50%;
            opacity: 0;
            animation: firework-explode 1.2s forwards; /* Increased duration for bigger explosion */
            z-index: 5;
        }
        @keyframes firework-explode {
            0% {
                transform: scale(0.3); /* Slightly larger start scale */
                opacity: 1;
            }
            100% {
                transform: scale(2.5); /* Significantly larger end scale */
                opacity: 0;
                box-shadow: 0 0 80px 30px var(--firework-color); /* Bigger glow */
            }
        }
    </style>
</head>
<body class="text-white">
    <div id="star-sky"></div>

    <div id="start-overlay">
        <button id="start-btn" class="px-8 py-4 bg-amber-400 text-gray-900 font-bold text-lg rounded-full shadow-lg hover:bg-amber-300 transition-transform transform hover:scale-105">Click to Begin</button>
    </div>

    <div id="main-content" class="hidden-content relative min-h-screen flex flex-col items-center justify-center p-4">
        <header class="text-center mb-8">
            <h1 class="font-serif text-5xl md:text-6xl text-amber-300">Happy Diwali!</h1>
            <p class="text-gray-300 mt-2">Wishing you a joyous and bright Festival of Lights.</p>
        </header>

        <main class="w-full max-w-2xl mx-auto space-y-6">
            <div class="card rounded-2xl p-6 shadow-lg">
                <h2 class="text-2xl font-semibold text-center text-gray-200 mb-2">Light a Diya</h2>
                <p class="text-center text-gray-400 text-sm mb-4">Click on a lamp to light it.</p>
                <div id="diya-container" class="flex flex-wrap justify-center gap-4"></div>
            </div>

            <div class="card rounded-2xl p-6 shadow-lg">
                <h2 class="text-2xl font-semibold text-center text-gray-200 mb-4">Share a Greeting</h2>
                <div class="min-h-[6rem] flex items-center justify-center p-4 bg-gray-900/50 rounded-lg">
                    <p id="greeting-text" class="text-lg text-gray-200 italic text-center">May your life be as bright and joyful as the festival lights.</p>
                </div>
                <div class="text-center">
                    <button id="new-greeting-btn" class="mt-4 px-6 py-2 bg-amber-400/80 text-gray-900 font-semibold rounded-full shadow-md hover:bg-amber-400 transition duration-300">New Greeting</button>
                </div>
            </div>
        </main>
        
        <footer class="mt-8 text-center">
             <button id="sound-toggle-btn" class="sound-btn text-3xl p-3 rounded-full bg-gray-900/50 shadow-lg">ðŸ”‡</button>
            <p class="text-gray-400 mt-4 text-sm">Created for a moment of peace and celebration.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const startOverlay = document.getElementById('start-overlay');
            const startBtn = document.getElementById('start-btn');
            const mainContent = document.getElementById('main-content');
            const diyaContainer = document.getElementById('diya-container');
            const soundToggleBtn = document.getElementById('sound-toggle-btn');
            const greetingText = document.getElementById('greeting-text');
            const newGreetingBtn = document.getElementById('new-greeting-btn');

            let soundOn = false;
            let audioInitialized = false;
            let ambientSynth, flameSynth, fireworkSynth;

            // --- Starry Sky Effect ---
            const starSky = document.getElementById('star-sky');
            const numStars = 100;
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 5}s`;
                starSky.appendChild(star);
            }

            // --- Diya Creation ---
            const numDiyas = 5;
            for (let i = 0; i < numDiyas; i++) {
                const diya = document.createElement('div');
                diya.classList.add('diya');
                diya.innerHTML = `<div class="diya-base"></div><div class="diya-flame"></div>`;
                diyaContainer.appendChild(diya);
            }

            function initializeAudio() {
                return new Promise((resolve, reject) => {
                    try {
                        if (typeof Tone === 'undefined') {
                            console.warn("Tone.js not available.");
                            return reject();
                        }
                        
                        Tone.start().then(() => {
                            ambientSynth = new Tone.PolySynth(Tone.AMSynth).toDestination();
                            ambientSynth.set({
                                harmonicity: 1.5,
                                envelope: { attack: 2, decay: 0.1, sustain: 0.8, release: 2 },
                                volume: -40 // Start quieter for fade-in
                            });

                            const chords = [["C3", "E3", "G3"], ["A2", "C3", "E3"], ["F2", "A2", "C3"], ["G2", "B2", "D3"]];
                            let chordIndex = 0;
                            new Tone.Loop(time => {
                                ambientSynth.triggerAttackRelease(chords[chordIndex++ % chords.length], "4n", time);
                            }, "1n").start(0);

                            flameSynth = new Tone.NoiseSynth({ noise: { type: 'pink' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0 }, volume: -15 }).toDestination();
                            fireworkSynth = new Tone.NoiseSynth({ noise: { type: 'white' }, envelope: { attack: 0.01, decay: 0.3, sustain: 0 }, volume: -8 }).toDestination(); // Adjusted firework volume and decay
                            
                            audioInitialized = true;
                            resolve();
                        }).catch(reject);
                    } catch (e) {
                        console.error("Could not initialize sound.", e);
                        reject(e);
                    }
                });
            }

            startBtn.addEventListener('click', () => {
                initializeAudio().then(() => {
                    Tone.Transport.start();
                    ambientSynth.volume.rampTo(-20, 2); // Fade in over 2 seconds
                    soundToggleBtn.textContent = 'ðŸ”Š';
                    soundOn = true;
                }).catch(() => {
                    soundToggleBtn.style.display = 'none'; // Hide sound button if audio fails
                }).finally(() => {
                    startOverlay.style.opacity = '0';
                    setTimeout(() => {
                        startOverlay.style.display = 'none';
                        mainContent.style.display = 'block';
                    }, 500);
                });
            });

            const fireworkColors = ['#ff6f61', '#ffec17', '#8d4de8', '#66bb6a', '#42a5f5'];
            function createFirework() {
                const firework = document.createElement('div');
                firework.className = 'firework';
                const color = fireworkColors[Math.floor(Math.random() * fireworkColors.length)];
                firework.style.setProperty('--firework-color', color);
                firework.style.backgroundColor = color;
                firework.style.left = `${Math.random() * 80 + 10}%`;
                firework.style.top = `${Math.random() * 50 + 10}%`;
                document.body.appendChild(firework);
                if (audioInitialized) fireworkSynth.triggerAttack();
                firework.addEventListener('animationend', () => firework.remove());
            }

            diyaContainer.querySelectorAll('.diya').forEach(diya => {
                diya.addEventListener('click', () => {
                    const flame = diya.querySelector('.diya-flame');
                    if (!flame) return;
                    flame.classList.toggle('lit');
                    if (flame.classList.contains('lit')) {
                        if (audioInitialized) flameSynth.triggerAttack();
                        createFirework();
                    }
                });
            });

            soundToggleBtn.addEventListener('click', () => {
                if (!audioInitialized) return;
                if (soundOn) {
                    Tone.Transport.pause();
                    soundToggleBtn.textContent = 'ðŸ”‡';
                } else {
                    Tone.Transport.start();
                    soundToggleBtn.textContent = 'ðŸ”Š';
                }
                soundOn = !soundOn;
            });

            const greetings = [
                "May the divine light of Diwali bring peace, prosperity, and happiness.",
                "Wishing you a sky full of fireworks and a heart full of joy.",
                "May the beauty of Diwali fill your home with happiness.",
                "Let each diya you light bring a glow of happiness to your face.",
                "Wishing you warmth, love, and light this Diwali and all year long.",
                "May the supreme light illumine your minds and enlighten your hearts."
            ];
            newGreetingBtn.addEventListener('click', () => {
                greetingText.textContent = greetings[Math.floor(Math.random() * greetings.length)];
            });
        });
    </script>
</body>
</html>


